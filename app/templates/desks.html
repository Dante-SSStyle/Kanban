<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="{{ url_for('static', path='/desks.css') }}">
    <meta charset="UTF-8">
    <title>План Канбан</title>
</head>
<body>
<h1 id="h1">План Канбан</h1>

<div class="desks">
    <div class="desks-list">

        {% for i in desks_list %}

        <a class="desk" href="{{host}}/desks?desk_id={{i.desk_id}}">
            {{i.desk_title}}
        </a>
        <button onclick="renameDesk('{{i.desk_id}}')">Удалить доску</button>
        <button onclick="deleteDesk('{{i.desk_id}}')">Переименовать доску</button>

        {% endfor %}

    </div>

    <button class="create-desk button">Создать доску</button>


</div>

</body>
<script>

    const createDeskRequest = async (deskTitle) => {
        const response = await fetch('{{host}}/desks/',
            {
                method: 'post',
                headers: {'Content-Type': 'application/json;charset=utf-8'},
                body: JSON.stringify({"title": deskTitle})
            }
        );
        return await response.json();

    }

    const deleteDeskRequest = async (deskId) => {
        const response = await fetch('{{host}}/desks/?desk_id='+deskId,
            {
                method: 'delete',
                headers: {'Content-Type': 'application/json;charset=utf-8'}
            }
        );
        return await response.json();
    }

    const renameDeskRequest = async (deskId, deskTitle) => {
        const response = await fetch('{{host}}/desks/?desk_id='+deskId,
            {
                method: 'put',
                headers: {'Content-Type': 'application/json;charset=utf-8'},
                body: JSON.stringify({"title": deskTitle})
            }
        );
        return await response.json();
    }

    const createDeskButton = document.querySelector('.create-desk');
    createDeskButton.addEventListener('click', async () => {
        const deskTitle = prompt("Название доски", "Новая доска");
        const newDesk = await createDeskRequest(deskTitle);
        console.log(newDesk) // todo проверять ошибки
        document.location.reload();
    });

    async function deleteDesk(deskId) {
        let check = confirm('Вы уверены?')
        if (check) {
            const delDesk = await deleteDeskRequest(deskId);
            console.log(delDesk) // todo проверять ошибки
            document.location.reload();
        }
    }

    async function renameDesk(deskId) {
        const deskNewTitle = prompt('Название доски', 'Новое имя');
        const updDesk = await renameDeskRequest(deskId, deskNewTitle);
        console.log(updDesk) // todo проверять ошибки
        document.location.reload();
    }

</script>
</html>
